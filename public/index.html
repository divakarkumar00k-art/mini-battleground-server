<!DOCTYPE html>
<html>
<head>
  <title>Mini Battleground</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #1b5e20;
    }
    canvas {
      display: block;
    }
    #ui {
      position: absolute;
      top: 10px;
      right: 10px;
      color: white;
      font-family: Arial;
      font-size: 18px;
    }
  </style>
</head>
<body>

<div id="ui">
  Alive: <span id="alive">0</span><br>
  Kills: <span id="kills">0</span><br>
  Health: <span id="health">100</span>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x: 200, y: 200 };
let players = {};
let alive = 0;
let kills = 0;
let health = 100;

const ws = new WebSocket("wss://mini-battleground-server-production.up.railway.app");

ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);

  if (data.type === "welcome") {
    player.id = data.playerId;
    health = data.health;
  }

  if (data.type === "playerMove") {
    players[data.playerId] = { x: data.x, y: data.y };
  }

  if (data.type === "aliveCount") {
    alive = data.total;
  }

  if (data.type === "killUpdate") {
    if (data.playerId === player.id) {
      kills = data.kills;
    }
  }

  if (data.type === "playerHit") {
    if (data.targetId === player.id) {
      health = data.health;
    }
  }
};

document.addEventListener("touchmove", (e) => {
  const touch = e.touches[0];
  player.x = touch.clientX;
  player.y = touch.clientY;

  ws.send(JSON.stringify({
    type: "move",
    x: player.x,
    y: player.y
  }));
});

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  ctx.fillStyle = "blue";
  ctx.beginPath();
  ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
  ctx.fill();

  // Other players
  ctx.fillStyle = "red";
  for (let id in players) {
    ctx.beginPath();
    ctx.arc(players[id].x, players[id].y, 20, 0, Math.PI * 2);
    ctx.fill();
  }

  document.getElementById("alive").innerText = alive;
  document.getElementById("kills").innerText = kills;
  document.getElementById("health").innerText = health;

  requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>
